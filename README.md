# E-SHOP example 

## Тестовое задание

Спроектировать базу данных со следующим минимальным набором таблиц:

    • Пользователь;
    • Товар (Книга);
    • Магазин;
    • Заказ.
Соискатель имеет полную свободу в проектировании связей между таблицами, 
набора полей для каждой из них, первичных и вторичных ключей, а также 
добавлении дополнительных таблиц. Будет оцениваться качество реализации в 
контексте целостности и избыточности полученной базы. Таблицы БД необходимо
заполнить произвольными данными (количество записей не имеет значения). 
Выбор СУБД остается за Соискателем, в рамках тестового задания можно
ограничиться sqlite.

_В схему добавлена корзина. Товар добавляется в корзину, а после по корзине формируется 
заказ_

Реализовать API со следующим набором функций:

    • Авторизация на портале используя связку логин — пароль от лица одного из пользователей;
    • Получение данных пользователя (имя, адрес эл. Почты и т.п.);
    • Просмотр истории заказов пользователя;
    • Добавление нового заказа (N книг каждая из которых в M количестве);
    • Просмотр ассортимента определенного магазина;
    • Деавторизация.

Методы для каждого из запросов («GET», «POST», «PUT» и др.) Соискатель может назначить 
самостоятельно. Нет необходимости в реализации графического или веб интерфейса — все 
запросы будут тестироваться с помощью **Postman**. Фреймворк для написания API — **aiohttp**. 
Библиотека для общения с базой данных — **sqlalchemy**. Также необходимо реализовать хранение 
сессий авторизовавшихся пользователей - в качестве хранилища сессий рекомендуется 
использовать **Redis**.

Дополнительно приветствуется:

    • Добавление логгирования;
    • Написание скрипта для создания и заполнения тестовой базы данных дабы облегчить тестирование полученной программы;
    • Написание setup.py или requirements.txt с указанием зависимостей;
    • Добавление краткого туториала с описанием запуска программы и требований, необходимых для ее работы;
    • Краткое документирование кода.

Вся работа должна выполняться на python 3.5 или более поздних версий. Результат необходимо 
разместить в публичном репозитории.

## Getting started
Для запуска необходимо выполнить команду:
`docker-compose up --build`

После запуска поднимуться следующие контейнеры:

    • Redis
    • PostgeSQL
    • Контейнер накатываня миграций на БД (по завршению контейнер закрывается)
    • Контейнер создания тестовых данных (по завршению контейнер закрывается) 
    • Контейнер веб приложения
    
Файл shop-api.postman_collection.json содержит примеры запросов на все API.

Все сущности в БД создаются случайным образом. Логины созданных пользователей выводятся в коммандной строке во время создания. 

**Доступ к БД:** 
- localhost:5432 
- db_name: postgres
- user: postgres 
- password: skytrack 

У всех пользователей пароль skytrack


## Что планируется
### По сервису e-shop
- Создать единый вид ошибок
- Создать единый способ формирования ошибок
- Создать документацию 
- Пересмотреть место получения данных и формирования ответа (унифицировать обработку)
- Добавить пагинацию
- Перейти на structlog и реализовать более подробное логирование
- Реализовать нагрузочное тестирование
- Узкие места перевести на асинхроную библиотеку доступа к БД 

### По архитектуре и деплою
- Добавить ELK и настроить логироание
- Разбить монолит на микросервисы
- Добавить proxy с поддержкой авторизации и "призмеления" https (н-р nginx)
- Добавить возможность масштабирования сервисов - добавить балансировщик (HAProxy)
- Мигрировать на docker stack
- Мигрировать на k8s 
